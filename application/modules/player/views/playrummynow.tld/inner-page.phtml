<?php
/**
 * Main layout file. Modify this to alter whole look of the site
 */
require_once APPLICATION_PATH . '/modules/player/forms/LanguageForm.php';
require_once APPLICATION_PATH . '/modules/player/forms/LoginForm.php';
require_once APPLICATION_PATH . '/modules/player/forms/RegistrationForm.php';

//$frontendDetails = Zend_Registry::getInstance()->isRegistered('frontendDetails-' . $_SERVER['HTTP_HOST'])?Zend_Registry::getInstance()->get('frontendDetails-' . $_SERVER['HTTP_HOST']):'';

$webConfig = Zend_Registry::getInstance()->isRegistered('webConfig')?Zend_Registry::getInstance()->get('webConfig'):'';
//$webConfig = isset($frontendDetails['webConfig'])?$frontendDetails['webConfig']:'';
$this->viewDir = isset($webConfig['viewDir'])?$webConfig['viewDir']:'zenfox.tld/';
$this->cssDir = isset($webConfig['cssDir'])?$webConfig['cssDir']:$this->viewDir;
$this->jsDir = isset($webConfig['jsDir'])?$webConfig['jsDir']:$this->viewDir;
$this->imagesDir = isset($webConfig['imagesDir'])?$webConfig['imagesDir']:$this->viewDir;
$this->htmlTitle = isset($webConfig['htmlTitle'])?$webConfig['htmlTitle']:'null';
$this->cdnImageServer = $webConfig['cdnImageServer'];

$frontController = Zend_Controller_Front::getInstance();
$controllerName = $frontController->getRequest()->getControllerName();
$actionName = $frontController->getRequest()->getActionName();
$pageAddress = $controllerName . '-' . $actionName;

?>
<? /* This line outputs the doctype we set in the bootstrap */ ?>
<?= $this->doctype() ?>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<?php 
$pixelSession = new Zend_Session_Namespace('pixelTracker');
if($pixelSession->value)
{
	echo $pixelSession->value;
    ?>
<!-- Google Code for RegistrationConversion Conversion Page -->
<script type="text/javascript">
		/* <![CDATA[ */
		var google_conversion_id = 1013384491;
		var google_conversion_language = "en";
		var google_conversion_format = "1";
		var google_conversion_color = "ffffff";
		var google_conversion_label = "sAKBCPXxzAIQq4qc4wM";
		var google_conversion_value = 0;
		if (1) {
	 		google_conversion_value = 1;
		}
	/* ]]> */
	</script>
<script type="text/javascript" src="http://www.googleadservices.com/pagead/conversion.js"></script>
<noscript>
<div style="display:inline;"><img height="1" width="1" style="border-style:none;" alt="" src="http://www.googleadservices.com/pagead/conversion/1013384491/?value=1&amp;label=sAKBCPXxzAIQq4qc4wM&amp;guid=ON&amp;script=0"/></div>
</noscript>
<?php
    $pixelSession->unsetAll();
}
$this->metatags();
$this->headScript()->appendFile('http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js');
$this->headScript()->appendFile($this->cdnImageServer. '/js/jquery/js/custom.js');
?>
<title><? echo $this->htmlTitle; echo isset($this->pageTitle)? "-".$this->pageTitle:""; ?></title>
<?$this->headLink()->appendStylesheet($this->cdnImageServer.'/css/'. $this->viewDir .'global.css') ?>
<?php 
$this->headScript()->appendFile($this->cdnImageServer.'/js/jquery_comments.js');
$this->headScript()->appendFile($this->cdnImageServer.'/js/wr.js');
?>
<?=$this->headLink()?>
<?php echo $this->headScript();?>
<!-- 
<link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print" />
<link rel="stylesheet" href="css/style.css" type="text/css" />
<script src="script/jquery.min.js" type="text/javascript"></script>
<script src="script/custom.js" type="text/javascript"></script>
<script type="text/javascript" src="iepngfix_tilebg.js"></script>
-->
<!--[if lt IE 7]>
<script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE7.js"></script>
<![endif]-->
<!--[if lt IE 8]>
  <link rel="stylesheet" href="<?=$this->cdnImageServer ?>/css/rummy.tld/css/blueprint/ie.css" type="text/css" media="screen, projection">
<![endif]-->
<!--Google Analytics-->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27546725-1']);
  _gaq.push(['_setDomainName', 'taashtime.com']);
  _gaq.push(['_trackPageview']);
  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head><body class=" <?php echo $pageAddress; ?>">
<div class="container tt_container_m tt_contai_wid">
  <div id="login-header" class="tt_contai_wid">
    <div class="ttlogo  pad-l-5"><a href ="/index/index"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/logo-animation.gif" width="240" height="50"  alt="Taash Logo" /></a></div>
    <div class="span-13 ">
      <div class="login-box">
        <?php 
		$session = new Zend_Auth_Storage_Session();
		$store = $session->read();
		    
		$isLoggedIn = isset($store)?true:false;
		if($isLoggedIn)
		    {
		    	$playerId = $store['id'];
		    	$imageName = md5("image" . $playerId) . '.jpg';
			    $loginName = $store['authDetails'][0]['login'];
			    $firstName = $store['authDetails'][0]['first_name'];
			    $cash = $store['authDetails'][0]['cash'];
			    $bonus = $store['authDetails'][0]['bonus_bank'] + $store['authDetails'][0]['bonus_winnings'];
			    $loyaltyPoints = $store['authDetails'][0]['loyalty_points_left'];
	    
			    $currency = new Zend_Currency();
			    $currencySession = new Zend_Session_Namespace('currency');
			 //   if($currencySession->oldValue != $currencySession->newValue)
			 //   {
				$source = $currency->getShortName('', $currencySession->oldValue);
				$destination = $currency->getShortName('', $currencySession->newValue);
				$currConv = new CurrencyConversion();
				$cash = $currConv->getConvertedValue($source, $destination, $cash);
				$bonus = $currConv->getConvertedValue($source, $destination, $bonus);
				$store['cash'] = $cash;
				$store['bonus'] = $bonus;
				$session->write($store);
		    	?>
        <div class="left login-controls color-blue welcome-box"> <strong>Welcome back, <?php echo empty($firstName)?$loginName:$firstName;?>! </strong></div>
        <div class="right login-controls small black-link"><a href="/auth/edit"><strong>Profile</strong></a> | <a href="/auth/changepwd"><strong>Change Password</strong></a> | <a href="/auth/logout"><strong>Logout</strong></a></div>
        <?php 
		    }
		    else
		    {
		    	$loginForm = new Player_LoginForm();
				$request = Zend_Controller_Front::getInstance()->getRequest();
				if($request->getParam('format') == 'json')
				{
					$loginForm->setAction('/auth/login/format/json');
				}
				else
				{
					$loginForm->setAction('/auth/login');
				}
				echo $loginForm;
		    }
		?>
        <!-- 
        <div class="left">
          <input name="" type="text" class="text" value="Username" size="20" maxlength="20"/>
        </div>
        <div class="left">
          <input name="" type="text" class="text" value="Password" />
        </div>
        <div class="left login-controls"><img src="images/login-button.png" width="60" height="25" alt="Login" /></div>
        <div class="left login-controls pad-l-15"><a href="#"><img src="images/fb-login.png" width="149" height="22" alt="FB-Temp" /></a>
          </li>
        </div>
        <div class="right login-controls small black-link"><a href="#">Forgot Password</a></div>
        -->
      </div>
    </div>
    <script type = "text/javascript">
    setInterval( "getLiveTables()", 30000);
    </script>
    <div class="ttlivetbl live-tables right">
      <div class="live-tables-number right pad-r-5" id = "live-tables">
        <?php 
      $onlineTable = new OnlineTable();
      echo $onlineTable->getLiveTables();
      ?>
      </div>
      <div class="right pad-t-9 " >Live Tables: </div>
    </div>
  </div>
  <div id="nav-bar" class="tt_contai_wid">
    <div class="nav-barl last left">
      <?php 
    	$partial = array('menu.phtml','player');
		$this->navigation()->menu()->setPartial($partial);
		echo $this->navigation()->menu()->render();
	?>
      <!-- 
      <ul id="main-menu">
        <li><a href="#" title="">
          <p class="menu-pad">Home</p>
          </a></li>
        <li><a href="#" title="">
          <p class="menu-pad">Join Now!</p>
          </a> </li>
        <li><a href="#" title="" >
          <p class="menu-pad">Rummy</p>
          </a></li>
        <li class="headlink"><a href="#" title="Test">
          <p class="menu-pad">Legality</p>
          </a> </li>
        <li class="headlink"><a href="#" title="Test">
          <p class="menu-pad">Promotions</p>
          </a> </li>
        <li class="headlink"><a href="#" title="Test">
          <p class="menu-pad">Winners</p>
          </a> </li>
        <li class="headlink"><a href="#" title="Test">
          <p class="menu-pad">Players Guide</p>
          </a> </li>
        <li><img src="images/top-menu-pipe.png"/></li>
      </ul>
      -->
    </div>
    <div class="ttoffer left"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/tt_ads.png" width="300" height="60" alt="get500" /></div>
  </div>
  <div id="inner-nav" class="tt_contai_wid">
    <ul id="sub-menu">
      <!-- 
      <li><a href="#" title="" class="selected-tab">
        <p class="menu-pad-1">Account Home</p>
        </a></li>
      <li><a href="#" title="" >
        <p class="menu-pad-1">Funds</p>
        </a></li>
      <li class="headlink"><a href="#" title="Test">
        <p class="menu-pad-1">Reports</p>
        </a> </li>
      <li class="headlink"><a href="#" title="Test">
        <p class="menu-pad-1">Support</p>
        </a> </li>
        -->
    </ul>
  </div>
  <div id="layout" class="tt_contai_wid">
    <div id="left-column" class="tt_l_colum">
      <?php 
        if((Zend_Controller_Front::getInstance()->getRequest()->getControllerName() == 'promotions') || (Zend_Controller_Front::getInstance()->getRequest()->getControllerName() == 'tournament'))
        {
        	?>
      <div id="inner-iframe-box">
        <?php 
        }
        else
        {
        	?>
        <div id="inner-box">
          <?php 
        }
        ?>
          <div class="inner-content">
            <?=$this->flashMessenger(); ?>
            <?php echo $this->layout()->content;?>
            <!-- a class = "top" href="#" style="position:absolute;">Back To Top</a-->
            <!--    <a class = "top" href="#" style="position:absolute;">Back To Top</a> -->
          </div>
        </div>
        <!-- 
      <div class="home-content left">
        <h2><strong>Game Rules</strong></h2>
        <p>Rummy is played with several flavors and variations. The version of  rummy played in this site, Taashtime.com, is detailed below.</p>
        <h4><strong>Types of Games</strong></h4>
        <p>There are commonly two types of games played on this site. </p>
        <ul class="bullet-normal">
          <li><a href="http://taashtime.com/en_IN/content/rules#sitngoT">Sit n' Go Tournaments</a></li>
          <li><a href="http://taashtime.com/en_IN/content/rules#stakeT">Stake Tournaments</a></li>
        </ul>
        <p>These games are played other than actual <a href="http://taashtime.com/en_IN/content/rules#tournaments">multi-tier tournaments</a>. Those games and their rules will be discussed in detail in the <a href="http://taashtime.com/en_IN/content/rules#tournaments"> tournaments </a>section. </p>
        <h3>&nbsp;</h3>
        <h3><strong>Pot Matches</strong></h3>
        <p>Matches where players play until they cross a pre-set number of points  are called Pot Matches. With each hand dealt, players accrue points for  their deadwood (or count). When the accumulated count is above the  pre-set limit, the player is eliminated. The game ends when there is  only one person below the pre-set number of points (i.e. the last man  standing).</p>
        <h3>&nbsp;</h3>
        <h3><strong>Sit N' Go Tournaments</strong></h3>
        <p>These are typically unscheduled matches that can be played by a casual  visitor. These are typically played until players cross a pre-set level  of points. The last man standing (below the level of points) is the  winner. Typically the pre-set point levels are 101, 201, 301, 401 and  501. As soon as a player reaches these levels, they are out of the  game.</p>
        <h4><strong>Terms</strong></h4>
        <ul class="bullet-normal">
          <li>Players may choose to leave the room at any point of time. On doing so, they automatically forfeit the game. </li>
          <li>New  players may enter a game while it is in progress. They will have to pay  the entry fee and will be started off with additional points</li>
          <li>The points awarded to players joining games in progress are number of rounds x points per early drop</li>
          <li>If the points to enter the game is higher than the existing pre-set limit, players are not allowed to join the game</li>
          <li>There is no limit on the number of times a player can re-enter a game</li>
        </ul>
        <p>Suppose there are 4 rounds played, they are given 4 x 20 = 80 points to  start them off in the game as they are joining a game already in  progress.
</p>
        <h4><strong>Winnings</strong></h4>
        <p>All the entry fee is pooled in. The winner (last man standing) is paid  a sum of the total in the pool after subtracting the management fee.</p>
        <h3>&nbsp;</h3>
        <h3><strong>Stake Tournaments</strong></h3>
        <p>These games are typically played for a pre-set number of rounds. A  round is defined as number of deals as there are number of players. If  there are 4 (four) players, cards must be dealt at least 4 times and  each player should get the opportunity to start the game. </p>
        <h4><strong>Terms</strong></h4>
        <ul class="bullet-normal">
          <li>The number of rounds a game will go on is pre-set and displayed along with the tournament infomormation </li>
          <li>No new players may enter a game while it is in progress. </li>
          <li>No players may leave the table before the pre-set number of rounds are completed. </li>
          <li>The cost per point is also pre-determined and explicitly mentioned      </li>
        </ul>
        <p class="pad-t-10"><div class="addthis_toolbox addthis_pill_combo">
    <a class="addthis_button_tweet" tw:count="horizontal"></a>
    <a class="addthis_button_facebook_like"></a>
</div><script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js"></script></p>
      </div>
      -->
      </div>
      <div id="right-column" class="join_r_colum last right">
        <div class="joinnowbg"  >
          <div class="joinnowpad">
            <?php 
    if($pageAddress == 'help-howtoplay')
    {
    	?>
            <img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/Login-strip-ad.png" width="270" height="550" border="0" usemap="#map" />
            <map name="map">
              <area shape="rect" coords="35,419,232,443"  href="/game/quickjoin" />
            </map>
            <?php
    }
    else
    {
    	?>
            <div id="join-now">
              <h2 class="pad-t-10 join-nowfont"><strong>JOIN NOW!</strong></h2>
              <div id="get-blurb-home" class="right">
                <div class="get-blurb-bfont">FREE </div>
                <div class="get-blurb-sfont">&nbsp; Rs. 25/-</div>
              </div>
              <div id="regForm" class="reg">
                <?php 
$form = new Player_RegistrationForm();
	        $form->setAction('/auth/signup');
		 	echo $form->registration('registration');
?>
                <!-- 
        <form id="player-registration-form" action="" method="post">
          <p class="bottom">
            <input type="text" value="Username" id="login" name="login" class="text">
          </p>        
<div id="get-blurb" class="right"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/get-25-blurb.png" width="139" height="76" alt="Get Rs. 25/-!" /></div><div class="clear"></div>

          <p class="bottom">
            <input type="text" value="Password" id="password" name="password" class="text">
          </p>
          <p class="bottom">
            <input type="text" value="Confirm password" id="confirmPassword" name="confirmPassword" class="text">
          </p>
           <p class="bottom">
            <input type="text" value="Email id" id="email" name="email" class="text">
          </p>
          <p class="pad-t-20">
            <input type="image" id="submit" name="submit" src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/join-now.png">
          </p>
          <p class="bottom pad-t-20"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/fb-connect.png" width="196" height="27" /></p>
        </form>
        -->
                <?php 
        //Signing up means you agree to the <a href="/content/terms">Terms & Conditions</a>
        ?>
              </div>
            </div>
            <?php
    }
      ?>
            <!-- 
      <div class="home-content left"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/grame-platform.png" width="267" height="209" alt="Game Platform" /></div>
      <div class="home-content left"><fb:like-box href="http://www.facebook.com/taashtime" width="267" show_faces="true" border_color="" stream="true" header="true"></fb:like-box></div>
      -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="clear"></div>
<div class="footer">
  <div  class="footerin">
    <div class="tt_supportby">
      <h4>Supported by:</h4>
      <div ><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/tt_supportedby.png"/></div>
    </div>
    <div class="footernav">
      <ul>
        <li><a href="/content/about">About Us</a></li>
        <li>|</li>
        <li><a href="/content/legal">Legality</a></li>
        <li>|</li>
        <li><a href="/content/terms">Terms of Service</a></li>
        <li>|</li>
        <li><a href="/content/withdrawterms">Withdrawal Terms</a></li>
        <li>|</li>
        <li><a href="/content/terms">Privacy Policy </a></li>
        <li>|</li>
        <li><a href="/index/winner">Winners</a></li>
        <li>|</li>
        <li><a href="/content/privacypolicy">Players Guide</a></li>
        <li>|</li>
        <li><a href="/content/contact">Contact Us</a></li>
      </ul>
    </div>
    <div class="tt-copyr">
      <p class="small line-small" >Taashtime is a site dedicated to providing the best online card playing experience. The traditional <br>
        Indian Rummy is their first game and it will be followed up by several others.</p>
      <p  class="small line-small">Copyright © 2011 TaashTime.com - All rights reserved.</p>
      <div class="tt_18plus"><img src="<?=$this->cdnImageServer ?>/css/rummy.tld/images/tt_18plus.png"/></div>
    </div>
  </div>
</div>
<?php 
 $this->JQuery()->enable();
    if($this->JQuery()->isEnabled())
    {
        //TODO:: Change the ui css depending on the frontend
        /*$this->JQuery()//->setUiLocalPath($this->baseUrl()."/js/jquery-ui-1.8.10.custom.min.js")
        		//->addStylesheet($this->baseUrl()."/css/rummy.tld/jquery-ui-1.8.9.custom.css");*/
        echo $this->JQuery();
        $this->facebook();
	if(Zend_Registry::get('piwikEnabled'))
	{
		$this->piwiktracker();
	}
        //echo $this->headMeta();
    }
 ?>
<!-- begin olark code -->
<script type='text/javascript'>/*{literal}<![CDATA[*/window.olark||(function(i){var e=window,h=document,a=e.location.protocol=="https:"?"https:":"http:",g=i.name,b="load";(function(){e[g]=function(){(c.s=c.s||[]).push(arguments)};var c=e[g]._={},f=i.methods.length;while(f--){(function(j){e[g][j]=function(){e[g]("call",j,arguments)}})(i.methods[f])}c.l=i.loader;c.i=arguments.callee;c.f=setTimeout(function(){if(c.f){(new Image).src=a+"//"+c.l.replace(".js",".png")+"&"+escape(e.location.href)}c.f=null},20000);c.p={0:+new Date};c.P=function(j){c.p[j]=new Date-c.p[0]};function d(){c.P(b);e[g](b)}e.addEventListener?e.addEventListener(b,d,false):e.attachEvent("on"+b,d);(function(){function l(){return["<head></head><",z,' onload="var d=',B,";d.getElementsByTagName('head')[0].",y,"(d.",A,"('script')).",u,"='",a,"//",c.l,"'",'"',"></",z,">"].join("")}var z="body",s=h[z];if(!s){return setTimeout(arguments.callee,100)}c.P(1);var y="appendChild",A="createElement",u="src",r=h[A]("div"),G=r[y](h[A](g)),D=h[A]("iframe"),B="document",C="domain",q;r.style.display="none";s.insertBefore(r,s.firstChild).id=g;D.frameBorder="0";D.id=g+"-loader";if(/MSIE[ ]+6/.test(navigator.userAgent)){D.src="javascript:false"}D.allowTransparency="true";G[y](D);try{D.contentWindow[B].open()}catch(F){i[C]=h[C];q="javascript:var d="+B+".open();d.domain='"+h.domain+"';";D[u]=q+"void(0);"}try{var H=D.contentWindow[B];H.write(l());H.close()}catch(E){D[u]=q+'d.write("'+l().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}c.P(2)})()})()})({loader:(function(a){return "static.olark.com/jsclient/loader0.js?ts="+(a?a[1]:(+new Date))})(document.cookie.match(/olarkld=([0-9]+)/)),name:"olark",methods:["configure","extend","declare","identify"]});olark.identify('8609-194-10-7825');/*]]>{/literal}*/</script>
<!-- end olark code -->
<!-- Tracker Script -->
<script type ="text/javascript" src="http://static.adohana.com/oa.js?usr=befa5c621cbbceace92907c751f8d506"></script>
<link type="text/css" href="<?=$this->cdnImageServer ?>/css/rummy.tld/jquery-ui-1.8.9.custom.css" rel="stylesheet"  />
<script src="<?=$this->cdnImageServer ?>/js/jquery_002.js" type="text/javascript"></script>
<script src="<?=$this->cdnImageServer ?>/js/jquery-ui.js" type="text/javascript"></script>
<script src="<?=$this->cdnImageServer ?>/js/demos.js" type="text/javascript"></script>
</body>
</html>
